"use strict";(self.webpackChunkmyblog=self.webpackChunkmyblog||[]).push([[7359],{5880:(e,n,c)=>{c.r(n),c.d(n,{assets:()=>a,contentTitle:()=>i,default:()=>l,frontMatter:()=>r,metadata:()=>d,toc:()=>u});var s=c(4848),t=c(8453);const r={},i="useReducer",d={id:"react/Hooks/useReducer/useReducer",title:"useReducer",description:"\u76ee\u5f55",source:"@site/docs/react/Hooks/useReducer/useReducer.md",sourceDirName:"react/Hooks/useReducer",slug:"/react/Hooks/useReducer/",permalink:"/myblog/docs/react/Hooks/useReducer/",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/react/Hooks/useReducer/useReducer.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"useLayoutEffect",permalink:"/myblog/docs/react/Hooks/useLayoutEffect/"},next:{title:"useRef",permalink:"/myblog/docs/react/Hooks/useRef/"}},a={},u=[{value:"\u76ee\u5f55",id:"\u76ee\u5f55",level:2},{value:"useReducer + immer",id:"usereducer--immer",level:2}];function p(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"usereducer",children:"useReducer"}),"\n",(0,s.jsx)(n.h2,{id:"\u76ee\u5f55",children:"\u76ee\u5f55"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#useReducer--immer",children:"useReducer + immer"})}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\u524d\u9762\u7528\u7684 ",(0,s.jsx)(n.code,{children:"setState"})," \u90fd\u662f\u76f4\u63a5\u4fee\u6539\u503c\uff0c\u90a3\u5982\u679c\u5728\u4fee\u6539\u503c\u4e4b\u524d\u9700\u8981\u6267\u884c\u4e00\u4e9b\u56fa\u5b9a\u7684\u903b\u8f91\u5462\uff1f"]}),"\n",(0,s.jsxs)(n.p,{children:["\u8fd9\u65f6\u5019\u5c31\u8981\u7528 ",(0,s.jsx)(n.code,{children:"useReducer"})," \u4e86\uff1a"]}),"\n",(0,s.jsxs)(n.p,{children:["\u6dfb\u52a0\u4e00\u4e2a",(0,s.jsx)(n.code,{children:" App3.tsx"}),"\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-react tsx",children:"import { Reducer, useReducer } from \"react\";\n\ninterface Data {\n    result: number;\n}\n\ninterface Action {\n    type: 'add' | 'minus',\n    num: number\n}\nfunction reducer(state: Data, action: Action) {\n\n    switch(action.type) {\n        case 'add':\n            return {\n                result: state.result + action.num\n            }\n        case 'minus': \n            return {\n                result: state.result - action.num\n            }\n    }\n    return state;\n}\n\nfunction App() {\n  const [res, dispatch] = useReducer<Reducer<Data, Action>>(reducer, { result: 0});\n\n  return (\n    <div>\n        <div onClick={() => dispatch({ type: 'add', num: 2 })}>\u52a0</div>\n        <div onClick={() => dispatch({ type: 'minus', num: 1 })}>\u51cf</div>\n        <div>{res.result}</div>\n    </div>\n  );\n}\n\nexport default App;\n\n\n"})}),"\n",(0,s.jsxs)(n.p,{children:["useReducer \u7684\u7c7b\u578b\u53c2\u6570\u4f20\u5165 Reducer",(0,s.jsx)(n.code,{children:"<\u6570\u636e\u7684\u7c7b\u578b\uff0caction \u7684\u7c7b\u578b>"})]}),"\n",(0,s.jsx)(n.p,{children:"\u7136\u540e\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f reducer\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u521d\u59cb\u6570\u636e\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u70b9\u51fb\u52a0\u7684\u65f6\u5019\uff0c\u89e6\u53d1 add \u7684 action\uff0c\u70b9\u51fb\u51cf\u7684\u65f6\u5019\uff0c\u89e6\u53d1 minus \u7684 action\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u5728 index.tsx \u91cc\u5f15\u5165\uff1a"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/07d4658f8c9a4a55bd376d645413c512~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=848&h=546&s=101144&e=png&b=1f1f1f",alt:""})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9e262d5d01304812b036b7abc5353888~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=864&h=432&s=65452&e=gif&f=26&b=fefefe",alt:""})}),"\n",(0,s.jsx)(n.p,{children:"\u5f53\u7136\uff0c\u4f60\u76f4\u63a5 setState \u4e5f\u53ef\u4ee5\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-react tsx",children:'import { useState } from "react";\n\nfunction App() {\n  const [res, setRes] = useState({ result: 0});\n\n  return (\n    <div>\n        <div onClick={() => setRes({ result: res.result + 2 })}>\u52a0</div>\n        <div onClick={() => setRes({ result: res.result - 1 })}>\u51cf</div>\n        <div>{res.result}</div>\n    </div>\n  );\n}\n\nexport default App;\n\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u6709\u540c\u5b66\u53ef\u80fd\u4f1a\u8bf4\uff0c\u7528 useState \u6bd4 useReducer \u7b80\u6d01\u591a\u4e86\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u786e\u5b9e\uff0c\u8fd9\u4e2a\u4f8b\u5b50\u4e0d\u590d\u6742\uff0c\u6ca1\u5fc5\u8981\u7528 useReducer\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u4f46\u5982\u679c\u8981\u6267\u884c\u6bd4\u8f83\u590d\u6742\u7684\u903b\u8f91\u5462\uff1f"}),"\n",(0,s.jsx)(n.p,{children:"\u7528 useState \u9700\u8981\u5728\u6bcf\u4e2a\u5730\u65b9\u90fd\u5199\u4e00\u904d\u8fd9\u4e2a\u903b\u8f91\uff0c\u800c\u7528 useReducer \u5219\u662f\u628a\u5b83\u5c01\u88c5\u5230 reducer \u91cc\uff0c\u901a\u8fc7 action \u89e6\u53d1\u5c31\u597d\u4e86\u3002"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u5f53\u4fee\u6539 state \u7684\u903b\u8f91\u6bd4\u8f83\u590d\u6742\uff0c\u7528 useReducer\u3002"})}),"\n",(0,s.jsx)(n.p,{children:"\u56de\u8fc7\u5934\u6765\u7ee7\u7eed\u770b useReducer\uff1a"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e6e76469d96e4be49e1cafebe7398de4~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1440&h=236&s=47974&e=png&b=1f1f1f",alt:""})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-react tsx",children:"const [res, dispatch] = useReducer<Reducer<Data, Action>, string>(reducer, 'zero', (param) => {\n    return {\n        result: param === 'zero' ? 0 : 1\n    }\n});\n\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u5b83\u8fd8\u6709\u53e6\u4e00\u79cd\u91cd\u8f7d\uff0c\u901a\u8fc7\u51fd\u6570\u6765\u521b\u5efa\u521d\u59cb\u6570\u636e\uff0c\u8fd9\u65f6\u5019 useReducer \u7b2c\u4e8c\u4e2a\u53c2\u6570\u5c31\u662f\u4f20\u7ed9\u8fd9\u4e2a\u51fd\u6570\u7684\u53c2\u6570\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u5e76\u4e14\u5728\u7c7b\u578b\u53c2\u6570\u91cc\u4e5f\u9700\u8981\u4f20\u5165\u5b83\u7684\u7c7b\u578b\u3002"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9e262d5d01304812b036b7abc5353888~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=864&h=432&s=65452&e=gif&f=26&b=fefefe",alt:""})}),"\n",(0,s.jsx)(n.h2,{id:"usereducer--immer",children:"useReducer + immer"}),"\n",(0,s.jsx)(n.p,{children:"\u6b64\u5916\uff0c\u4f7f\u7528 reducer \u6709\u4e00\u4e2a\u7279\u522b\u8981\u6ce8\u610f\u7684\u5730\u65b9\uff1a"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fb65b8784ea34ef5ae169c54a0c3af4a~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=812&h=582&s=71068&e=png&b=1f1f1f",alt:""})}),"\n",(0,s.jsx)(n.p,{children:"\u5982\u679c\u4f60\u76f4\u63a5\u4fee\u6539\u539f\u59cb\u7684 state \u8fd4\u56de\uff0c\u662f\u89e6\u53d1\u4e0d\u4e86\u91cd\u65b0\u6e32\u67d3\u7684\uff1a"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fd6bb26f55004e22b9829a2afc9bca55~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=694&h=440&s=51881&e=gif&f=23&b=fefefe",alt:""})}),"\n",(0,s.jsx)(n.p,{children:"\u5fc5\u987b\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684\u5bf9\u8c61\u624d\u884c\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u4f46\u8fd9\u4e5f\u6709\u4e2a\u95ee\u9898\uff0c\u5982\u679c\u5bf9\u8c61\u7ed3\u6784\u5f88\u590d\u6742\uff0c\u6bcf\u6b21\u90fd\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5bf9\u8c61\u4f1a\u6bd4\u8f83\u7e41\u7410\uff0c\u800c\u4e14\u6027\u80fd\u4e5f\u4e0d\u597d\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u6bd4\u5982\u8fd9\u6837\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-react tsx",children:"import { Reducer, useReducer } from \"react\";\n\ninterface Data {\n    a: {\n        c: {\n            e: number,\n            f: number\n        },\n        d: number\n    },\n    b: number\n}\n\ninterface Action {\n    type: 'add',\n    num: number\n}\n\nfunction reducer(state: Data, action: Action) {\n\n    switch(action.type) {\n        case 'add':\n            return {\n                ...state,\n                a: {\n                    ...state.a,\n                    c: {\n                        ...state.a.c,\n                        e: state.a.c.e + action.num,\n                    },\n                },\n            }\n    }\n    return state;\n}\n\nfunction App() {\n  const [res, dispatch] = useReducer<Reducer<Data, Action>, string>(reducer, 'zero', (param) => {\n    return {\n        a: {\n            c: {\n                e: 0,\n                f: 0\n            },\n            d: 0\n        },\n        b: 0\n    }\n  });\n\n  return (\n    <div>\n        <div onClick={() => dispatch({ type: 'add', num: 2 })}>\u52a0</div>\n        <div>{JSON.stringify(res)}</div>\n    </div>\n  );\n}\n\nexport default App;\n\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u8fd9\u91cc\u7684 data \u662f\u4e00\u4e2a\u590d\u6742\u7684\u5bf9\u8c61\u7ed3\u6784\uff0c\u6211\u4eec\u9700\u8981\u6539\u7684\u662f\u5176\u4e2d\u7684\u4e00\u4e2a\u5c5e\u6027\uff0c\u4f46\u662f\u4e3a\u4e86\u521b\u5efa\u65b0\u5bf9\u8c61\uff0c\u8981\u628a\u5176\u4f59\u5c5e\u6027\u4f9d\u6b21\u590d\u5236\u4e00\u904d\u3002"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6fa4294aa3cd4f52903347e5ad33a64c~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=660&h=276&s=70116&e=gif&f=20&b=fdfdfd",alt:""})}),"\n",(0,s.jsx)(n.p,{children:"\u8fd9\u6837\u80fd\u5b8c\u6210\u529f\u80fd\uff0c\u4f46\u662f\u5199\u8d77\u6765\u5f88\u9ebb\u70e6\uff0c\u4e5f\u4e0d\u597d\u7ef4\u62a4\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u6709\u6ca1\u6709\u4ec0\u4e48\u66f4\u597d\u7684\u65b9\u5f0f\u5462\uff1f"}),"\n",(0,s.jsx)(n.p,{children:"\u6709\uff0c\u590d\u6742\u5bf9\u8c61\u7684\u4fee\u6539\u5c31\u8981\u7528 immutable \u76f8\u5173\u7684\u5e93\u4e86\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u6700\u5e38\u7528\u7684\u662f immer\uff1a"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"npm install --save immer"})," "]}),"\n",(0,s.jsx)(n.p,{children:"\u7528\u6cd5\u76f8\u5f53\u7b80\u5355\uff0c\u53ea\u6709\u4e00\u4e2a produce \u7684 api\uff1a"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/74c7cb0691684797846a97e34d82cbf0~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=970&h=648&s=79713&e=png&b=1f1f1f",alt:""})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-react tsx",children:"return produce(state, (state) => {\n    state.a.c.e += action.num\n})\n\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"\u7b2c\u4e00\u4e2a\u53c2\u6570"}),"\u662f\u8981\u4fee\u6539\u7684\u5bf9\u8c61\uff0c",(0,s.jsx)(n.code,{children:"\u7b2c\u4e8c\u4e2a\u53c2\u6570"}),"\u7684\u51fd\u6570\u91cc\u76f4\u63a5\u4fee\u6539\u8fd9\u4e2a\u5bf9\u8c61\u7684\u5c5e\u6027\uff0c\u8fd4\u56de\u7684\u7ed3\u679c\u5c31\u662f\u4e00\u4e2a\u65b0\u7684\u5bf9\u8c61\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u6d4b\u8bd5\u4e0b\uff1a"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2e96c9dca37640b49395bdec1416ac8c~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=602&h=242&s=62197&e=gif&f=20&b=fdfdfd",alt:""})}),"\n",(0,s.jsx)(n.p,{children:"\u529f\u80fd\u6b63\u5e38\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u7528\u8d77\u6765\u8d85\u7ea7\u7b80\u5355\u3002"}),"\n",(0,s.jsx)(n.p,{children:"immer \u662f\u4f9d\u8d56 Proxy \u5b9e\u73b0\u7684\uff0c\u5b83\u4f1a\u76d1\u542c\u4f60\u5728\u51fd\u6570\u91cc\u5bf9\u5c5e\u6027\u7684\u4fee\u6539\uff0c\u7136\u540e\u5e2e\u4f60\u521b\u5efa\u4e00\u4e2a\u65b0\u5bf9\u8c61\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u521a\u624d\u53ea\u8bf4\u4e86 reducer \u9700\u8981\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684\u5bf9\u8c61\uff0c\u624d\u4f1a\u89e6\u53d1\u6e32\u67d3\uff0c\u5176\u5b9e useState \u4e5f\u662f\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u6bd4\u5982\u8fd9\u6837\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-react tsx",children:'import { useState } from "react";\n\nfunction App() {\n    const [obj, setObj] = useState({\n        a: {\n            c: {\n                e: 0,\n                f: 0\n            },\n            d: 0\n        },\n        b: 0\n    });\n\n    return (\n        <div>\n            <div onClick={() => {\n                obj.a.c.e ++;\n                setObj(obj);\n            }}>\u52a0</div>\n            <div>{JSON.stringify(obj)}</div>\n        </div>\n    );\n}\n\nexport default App;\n\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u56e0\u4e3a\u5bf9\u8c61\u5f15\u7528\u6ca1\u53d8\uff0c\u540c\u6837\u4e0d\u4f1a\u91cd\u65b0\u6e32\u67d3\uff1a"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3fc79973dcb14bc68292fd02aa6b2f3e~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=710&h=426&s=51317&e=gif&f=28&b=fdfdfd",alt:""})}),"\n",(0,s.jsx)(n.p,{children:"\u4e5f\u53ef\u4ee5\u7528 immer\uff1a"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/742e8dd844334ad78b7d51bcbb176d18~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=962&h=526&s=69735&e=png&b=202020",alt:""})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-react tsx",children:"setObj(produce(obj, (obj) => {\n    obj.a.c.e ++;\n}))\n\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8c06eee6198548ca93691db984b911ec~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=710&h=426&s=70223&e=gif&f=22&b=fdfdfd",alt:""})}),"\n",(0,s.jsxs)(n.p,{children:["\u7efc\u4e0a\uff0c",(0,s.jsx)(n.strong,{children:"\u5728 react \u91cc\uff0c\u53ea\u8981\u6d89\u53ca\u5230 state \u7684\u4fee\u6539\uff0c\u5c31\u5fc5\u987b\u8fd4\u56de\u65b0\u7684\u5bf9\u8c61\uff0c\u4e0d\u7ba1\u662f useState \u8fd8\u662f useReducer\u3002"})]}),"\n",(0,s.jsx)(n.p,{children:"\u5982\u679c\u662f\u590d\u6742\u7684\u6df1\u5c42\u5bf9\u8c61\u7684\u4fee\u6539\uff0c\u53ef\u4ee5\u7528 immer \u6765\u4f18\u5316\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u4e3a\u4ec0\u4e48\u5927\u5bb6\u4f1a\u8bf4 React \u63a8\u5d07\u7684\u662f\u6570\u636e\u4e0d\u53ef\u53d8\uff1f"}),"\n",(0,s.jsx)(n.p,{children:"\u5c31\u662f\u56e0\u4e3a\u8fd9\u4e2a\u3002"})]})}function l(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}},8453:(e,n,c)=>{c.d(n,{R:()=>i,x:()=>d});var s=c(6540);const t={},r=s.createContext(t);function i(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);